{"version":3,"file":"react-global-states.umd.js","sources":["../node_modules/@babel/runtime/helpers/extends.js","../src/index.ts"],"sourcesContent":["function _extends() {\n  module.exports = _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}\n\nmodule.exports = _extends;","import { useState, useEffect } from 'react';\n\ninterface StoreMethods<Store> {\n\tuseGlobalStates(propsToConnectTo: (keyof Store)[]): Partial<Store>;\n\tgetStates(): Store;\n\tsetStates(newStore: Store): void;\n\tupdateStates(partial: Partial<Store>): void;\n}\n\nexport const createStore = function createStore<YourStoreInterface>(\n\tinitStore: YourStoreInterface\n): StoreMethods<YourStoreInterface> {\n\ttype Store = YourStoreInterface;\n\ttype StoreKey = keyof Store;\n\ttype Handler = (store: Store) => void;\n\n\t// \"The\" global store\n\tlet store = initStore;\n\n\t// internal publisher-subscriber system to\n\t// notify containers of store changes.\n\tconst pubsub = {\n\t\thandlers: [] as Handler[],\n\t\tsubscribe(handler: Handler): void {\n\t\t\t// console.log('subscribed');\n\t\t\tif (!this.handlers.includes(handler)) {\n\t\t\t\tthis.handlers.push(handler);\n\t\t\t}\n\t\t},\n\t\tunsubscribe(handler: Handler): void {\n\t\t\t// console.log('unsubscribed');\n\t\t\tconst index = this.handlers.indexOf(handler);\n\t\t\tif (index > -1) {\n\t\t\t\tthis.handlers.splice(index, 1);\n\t\t\t}\n\t\t},\n\t\tnotify(newStore: Store): void {\n\t\t\tthis.handlers.forEach((handler: Handler) => handler(newStore));\n\t\t},\n\t};\n\n\tconst getStates = (): YourStoreInterface => ({ ...store });\n\n\t// global state merger. unlike redux, I am not enforcing reducer layer\n\tconst plainObjectPrototype = Object.getPrototypeOf({});\n\tconst isPlainObject = (obj: unknown): boolean =>\n\t\tBoolean(\n\t\t\tobj &&\n\t\t\t\ttypeof obj === 'object' &&\n\t\t\t\tObject.getPrototypeOf(obj) === plainObjectPrototype\n\t\t);\n\t// updateStates merges properties upto two levels of the data store\n\tconst updateStates = (partial: Partial<Store>): void => {\n\t\tconst newStore = { ...store };\n\t\tconst propNames = Object.keys(partial);\n\t\twhile (propNames.length) {\n\t\t\tconst propName: string = propNames.shift() as string;\n\t\t\tconst oldValue = store[propName];\n\t\t\tconst newValue = partial[propName];\n\t\t\tif (isPlainObject(oldValue) && isPlainObject(newValue)) {\n\t\t\t\tnewStore[propName] = {\n\t\t\t\t\t...oldValue,\n\t\t\t\t\t...newValue,\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\tnewStore[propName] = newValue;\n\t\t\t}\n\t\t}\n\t\tstore = newStore;\n\t\tpubsub.notify(newStore);\n\t};\n\n\tconst setStates = (newStore: Store): void => {\n\t\tstore = newStore;\n\t\tpubsub.notify(newStore);\n\t};\n\n\t// utility\n\tconst twoLevelIsEqual = (\n\t\toldState: Store,\n\t\tnewState: Store,\n\t\tlevel = 1\n\t): boolean => {\n\t\tif (\n\t\t\toldState === null ||\n\t\t\tnewState === null ||\n\t\t\toldState === undefined ||\n\t\t\tnewState === undefined\n\t\t) {\n\t\t\treturn oldState === newState;\n\t\t}\n\n\t\tconst oldStatePrototype = Object.getPrototypeOf(oldState);\n\t\tif (\n\t\t\tlevel <= 2 &&\n\t\t\t(oldStatePrototype === plainObjectPrototype || Array.isArray(oldState)) &&\n\t\t\toldStatePrototype === Object.getPrototypeOf(newState)\n\t\t) {\n\t\t\t// check if all props of oldState is in newState\n\t\t\tlet isEqual = Object.entries(oldState).every(([key, val]) =>\n\t\t\t\ttwoLevelIsEqual(val, newState[key], level + 1)\n\t\t\t);\n\t\t\t// check if all props of newState is in oldState\n\t\t\tisEqual =\n\t\t\t\tisEqual &&\n\t\t\t\tObject.entries(newState).every(([key, val]) =>\n\t\t\t\t\ttwoLevelIsEqual(oldState[key], val, level + 1)\n\t\t\t\t);\n\t\t\t// if so, they are equal (upto two levels).\n\t\t\treturn isEqual;\n\t\t}\n\t\tif (oldState instanceof Date && newState instanceof Date) {\n\t\t\treturn oldState.getTime() === newState.getTime();\n\t\t}\n\t\treturn oldState === newState;\n\t};\n\n\tconst useGlobalStates = (\n\t\tpropsToConnectTo: StoreKey[]\n\t): Partial<YourStoreInterface> => {\n\t\tconst [state, setState] = useState(\n\t\t\tpropsToConnectTo.reduce((acc, propName) => {\n\t\t\t\tif (propName in store) {\n\t\t\t\t\tacc[propName] = store[propName];\n\t\t\t\t}\n\t\t\t\treturn acc;\n\t\t\t}, {} as Store)\n\t\t);\n\n\t\tconst propNameHash = propsToConnectTo\n\t\t\t.slice()\n\t\t\t.sort()\n\t\t\t.join('|');\n\t\tuseEffect(() => {\n\t\t\tconst newStateHandler = (newStore: Store): void => {\n\t\t\t\tconst newState = propsToConnectTo.reduce((acc, propName) => {\n\t\t\t\t\tif (propName in newStore) {\n\t\t\t\t\t\tacc[propName] = newStore[propName];\n\t\t\t\t\t}\n\t\t\t\t\treturn acc;\n\t\t\t\t}, {} as Store);\n\t\t\t\t// console.log('current state', state);\n\t\t\t\t// console.log('new state', newState);\n\t\t\t\t// console.log('twoLevelIsEqual', twoLevelIsEqual(state, newState));\n\t\t\t\tif (!twoLevelIsEqual(state, newState)) {\n\t\t\t\t\tsetState(newState);\n\t\t\t\t}\n\t\t\t};\n\t\t\tpubsub.subscribe(newStateHandler);\n\t\t\t// on component unmount, unsubscribe to prevent mem leak\n\t\t\treturn (): void => pubsub.unsubscribe(newStateHandler);\n\t\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t\t}, [state, propNameHash]);\n\n\t\treturn state;\n\t};\n\n\treturn {\n\t\tuseGlobalStates,\n\t\tgetStates,\n\t\tsetStates,\n\t\tupdateStates,\n\t};\n};\n\nconst defaultStore = createStore({});\n\nexport const {\n\tuseGlobalStates,\n\tgetStates,\n\tsetStates,\n\tupdateStates,\n} = defaultStore;\n\n// -------------- app code testing ------------------\n/*\ninterface MyStoreType {\n\tgreeting: string;\n\tcart: {\n\t\ttotalQty: number;\n\t\titems: {\n\t\t\tqty: number;\n\t\t\tsku: string;\n\t\t}[];\n\t};\n\ttest: {\n\t\ttest2: string;\n\t};\n}\nconst { updateStates: updater } = createStore<MyStoreType>({\n\tgreeting: 'hi',\n\tcart: { totalQty: 0, items: [] },\n\ttest: { test2: 'hi' },\n});\nupdater({ greeting: 'hi' }); // no error\nupdater({ cart: { greeting: 'hi' } }); // error\nupdater({ cart: { cart: {} } }); // error\nupdater({ cart: { test: {} } }); // error\nupdater({ cart: { test2: 'h1' } }); // error\nupdater({ cart: { totalQty: 0, items: [] } }); // no error\n*/\n"],"names":["createStore","initStore","store","pubsub","handlers","subscribe","handler","includes","push","unsubscribe","index","indexOf","splice","notify","newStore","forEach","getStates","plainObjectPrototype","Object","getPrototypeOf","isPlainObject","obj","Boolean","updateStates","partial","propNames","keys","length","propName","shift","oldValue","newValue","twoLevelIsEqual","oldState","newState","level","undefined","oldStatePrototype","Array","isArray","isEqual","entries","every","key","val","Date","getTime","useGlobalStates","propsToConnectTo","useState","reduce","acc","state","setState","propNameHash","slice","sort","join","useEffect","newStateHandler","setStates","defaultStore"],"mappings":"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"}