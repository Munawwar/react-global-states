{"version":3,"file":"react-global-states.umd.js","sources":["../node_modules/@babel/runtime/helpers/extends.js","../src/index.ts"],"sourcesContent":["function _extends() {\n  module.exports = _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}\n\nmodule.exports = _extends;","import { useState, useEffect } from 'react';\n\ninterface StoreMethods<Store> {\n\tuseGlobalStates(propsToConnectTo: (keyof Store)[]): Partial<Store>;\n\tgetStates(): Store;\n\tupdateStates(partial: Store): void;\n\tcreateSubPropUpdater<Prop extends keyof Store>(\n\t\tpropName: Prop\n\t): (partial: Partial<Store[Prop]>) => void;\n}\n\nexport const createStore = function createStore<YourStoreInterface>(\n\tinitStore: YourStoreInterface\n): StoreMethods<YourStoreInterface> {\n\ttype Store = YourStoreInterface;\n\ttype StoreKey = keyof Store;\n\ttype Handler = (store: Store) => void;\n\n\t// \"The\" global store\n\tlet store = initStore;\n\n\t// internal publisher-subscriber system to\n\t// notify containers of store changes.\n\tconst pubsub = {\n\t\thandlers: [] as Handler[],\n\t\tsubscribe(handler: Handler): void {\n\t\t\t// console.log('subscribed');\n\t\t\tif (!this.handlers.includes(handler)) {\n\t\t\t\tthis.handlers.push(handler);\n\t\t\t}\n\t\t},\n\t\tunsubscribe(handler: Handler): void {\n\t\t\t// console.log('unsubscribed');\n\t\t\tconst index = this.handlers.indexOf(handler);\n\t\t\tif (index > -1) {\n\t\t\t\tthis.handlers.splice(index, 1);\n\t\t\t}\n\t\t},\n\t\tnotify(newStore: Store): void {\n\t\t\tthis.handlers.forEach((handler: Handler) => handler(newStore));\n\t\t},\n\t};\n\n\tconst getStates = (): YourStoreInterface => ({ ...store });\n\n\t// global state merger. unlike redux, I am not enforcing reducer layer\n\tconst updateStates = (partial: Store): void => {\n\t\tconst newStore = {\n\t\t\t...store,\n\t\t\t...partial,\n\t\t};\n\t\tstore = newStore;\n\t\tpubsub.notify(newStore);\n\t};\n\n\t// curry function to partially update a sub property of global store.\n\t// e.g const updateCartState = createSubPropUpdater('cart');\n\t// updateCartState({ items: [], quantity: 0 });\n\t// this is equivalent to\n\t// updateStates({ cart: { ...store.cart, items: [], quantity: 0 } })\n\tconst createSubPropUpdater = <Prop extends StoreKey>(propName: Prop) => (\n\t\tpartial: Partial<Store[Prop]>\n\t): void => {\n\t\tconst newStore = {\n\t\t\t...store,\n\t\t\t[propName]: {\n\t\t\t\t...(store[propName] || {}),\n\t\t\t\t...partial,\n\t\t\t},\n\t\t};\n\t\tstore = newStore;\n\t\tpubsub.notify(newStore);\n\t};\n\n\t// utility\n\tconst plainObjectPrototype = Object.getPrototypeOf({});\n\tconst twoLevelIsEqual = (\n\t\toldState: Store,\n\t\tnewState: Store,\n\t\tlevel = 1\n\t): boolean => {\n\t\tif (\n\t\t\toldState === null ||\n\t\t\tnewState === null ||\n\t\t\toldState === undefined ||\n\t\t\tnewState === undefined\n\t\t) {\n\t\t\treturn oldState === newState;\n\t\t}\n\n\t\tconst oldStatePrototype = Object.getPrototypeOf(oldState);\n\t\tif (\n\t\t\tlevel <= 2 &&\n\t\t\t(oldStatePrototype === plainObjectPrototype || Array.isArray(oldState)) &&\n\t\t\toldStatePrototype === Object.getPrototypeOf(newState)\n\t\t) {\n\t\t\t// check if all props of oldState is in newState\n\t\t\tlet isEqual = Object.entries(oldState).every(([key, val]) =>\n\t\t\t\ttwoLevelIsEqual(val, newState[key], level + 1)\n\t\t\t);\n\t\t\t// check if all props of newState is in oldState\n\t\t\tisEqual =\n\t\t\t\tisEqual &&\n\t\t\t\tObject.entries(newState).every(([key, val]) =>\n\t\t\t\t\ttwoLevelIsEqual(oldState[key], val, level + 1)\n\t\t\t\t);\n\t\t\t// if so, they are equal (upto two levels).\n\t\t\treturn isEqual;\n\t\t}\n\t\tif (oldState instanceof Date && newState instanceof Date) {\n\t\t\treturn oldState.getTime() === newState.getTime();\n\t\t}\n\t\treturn oldState === newState;\n\t};\n\n\tconst useGlobalStates = (\n\t\tpropsToConnectTo: StoreKey[]\n\t): Partial<YourStoreInterface> => {\n\t\tconst [state, setState] = useState(\n\t\t\tpropsToConnectTo.reduce((acc, propName) => {\n\t\t\t\tif (propName in store) {\n\t\t\t\t\tacc[propName] = store[propName];\n\t\t\t\t}\n\t\t\t\treturn acc;\n\t\t\t}, {} as Store)\n\t\t);\n\n\t\tconst propNameHash = propsToConnectTo\n\t\t\t.slice()\n\t\t\t.sort()\n\t\t\t.join('|');\n\t\tuseEffect(() => {\n\t\t\tconst newStateHandler = (newStore: Store): void => {\n\t\t\t\tconst newState = propsToConnectTo.reduce((acc, propName) => {\n\t\t\t\t\tif (propName in newStore) {\n\t\t\t\t\t\tacc[propName] = newStore[propName];\n\t\t\t\t\t}\n\t\t\t\t\treturn acc;\n\t\t\t\t}, {} as Store);\n\t\t\t\t// console.log('current state', state);\n\t\t\t\t// console.log('new state', newState);\n\t\t\t\t// console.log('twoLevelIsEqual', twoLevelIsEqual(state, newState));\n\t\t\t\tif (!twoLevelIsEqual(state, newState)) {\n\t\t\t\t\tsetState(newState);\n\t\t\t\t}\n\t\t\t};\n\t\t\tpubsub.subscribe(newStateHandler);\n\t\t\t// on component unmount, unsubscribe to prevent mem leak\n\t\t\treturn (): void => pubsub.unsubscribe(newStateHandler);\n\t\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t\t}, [state, propNameHash]);\n\n\t\treturn state;\n\t};\n\n\treturn {\n\t\tuseGlobalStates,\n\t\tgetStates,\n\t\tupdateStates,\n\t\tcreateSubPropUpdater,\n\t};\n};\n\nconst defaultStore = createStore({});\n\nexport const {\n\tuseGlobalStates,\n\tgetStates,\n\tupdateStates,\n\tcreateSubPropUpdater,\n} = defaultStore;\n\n// -------------- app code testing ------------------\n/*\ninterface MyStoreType {\n\tgreeting: string;\n\tcart: {\n\t\ttotalQty: number;\n\t\titems: {\n\t\t\tqty: number;\n\t\t\tsku: string;\n\t\t}[];\n\t};\n\ttest: {\n\t\ttest2: string;\n\t};\n}\nconst myStore = createStore<MyStoreType>({\n\tgreeting: 'hi',\n\tcart: { totalQty: 0, items: [] },\n\ttest: { test2: 'hi' },\n});\nconst updateCart = myStore.createSubPropUpdater('cart');\nupdateCart({ greeting: 'hi' }); // error\nupdateCart({ cart: {} }); // error\nupdateCart({ test: {} }); // error\nupdateCart({ test2: 'h1' }); // error\nupdateCart({ totalQty: 0, items: [] }); // no error\n*/\n"],"names":["createStore","initStore","store","pubsub","handlers","subscribe","handler","includes","push","unsubscribe","index","indexOf","splice","notify","newStore","forEach","getStates","updateStates","partial","plainObjectPrototype","Object","getPrototypeOf","twoLevelIsEqual","oldState","newState","level","undefined","oldStatePrototype","Array","isArray","isEqual","entries","every","key","val","Date","getTime","useGlobalStates","propsToConnectTo","useState","reduce","acc","propName","state","setState","propNameHash","slice","sort","join","useEffect","newStateHandler","createSubPropUpdater","defaultStore"],"mappings":"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"}